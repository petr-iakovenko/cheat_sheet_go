# üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –≤ Go: –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

–í–∏–¥–µ–æ - [–°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –≤ Go –∑–∞ 15 –º–∏–Ω—É—Ç](https://www.youtube.com/watch?v=_w96fJxDeQQ)

–°—Ç–∞—Ç—å—è –Ω–∞ —Ö–∞–±—Ä–µ - [Go's Garbage Collection: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å](https://habr.com/ru/companies/avito/articles/753244/)

–°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –≤ Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º —Ç—Ä–µ—Ö—Ü–≤–µ—Ç–Ω–æ–π –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –±–∞—Ä—å–µ—Ä –∑–∞–ø–∏—Å–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –Ø –æ–±—ä—è—Å–Ω—é —ç—Ç–æ –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –∏ –ø–æ–Ω—è—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö —Å —ç–º–æ–¥–∑–∏, —á—Ç–æ–±—ã –≤—ã –ª–µ–≥–∫–æ —É—Å–≤–æ–∏–ª–∏ —ç—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

## üöÆ –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ ‚Äî —ç—Ç–æ –∫–æ–º–Ω–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã (–æ–±—ä–µ–∫—Ç—ã). –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤–∞–º –Ω—É–∂–Ω—ã, –∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ ‚Äî —É–∂–µ –Ω–µ—Ç. –°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ —Ö–æ–¥–∏—Ç –ø–æ –∫–æ–º–Ω–∞—Ç–µ –∏ —É–±–∏—Ä–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –≤–µ—â–∏, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤—ã—Ö.

## üé® –¢—Ä–µ—Ö—Ü–≤–µ—Ç–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞: –ø–æ–Ω—è—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

–í Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º —Ç—Ä–µ—Ö—Ü–≤–µ—Ç–Ω–æ–π –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏. –≠—Ç–æ –∫–∞–∫ —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏ –≤ —Ç—Ä–∏ —Ü–≤–µ—Ç–∞:

- ‚ö™ **–ë–µ–ª—ã–π** ‚Äî "–≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –º—É—Å–æ—Ä"
- üîò **–°–µ—Ä—ã–π** ‚Äî "–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑–∏ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞"
- ‚ö´ **–ß–µ—Ä–Ω—ã–π** ‚Äî "—Ç–æ—á–Ω–æ –Ω—É–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ–º"

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —ç—Ç–æ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Å —ç–º–æ–¥–∑–∏:

```go
// –ü—Ä–∏–º–µ—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏
type Person struct {
    Name string
    Friend *Person  // –°—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–∞
}

func main() {
    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã
    alice := &Person{Name: "–ê–ª–∏—Å–∞"} // ‚ö™ —Å–Ω–∞—á–∞–ª–∞ –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –±–µ–ª—ã–µ
    bob := &Person{Name: "–ë–æ–±"}     // ‚ö™
    charlie := &Person{Name: "–ß–∞—Ä–ª–∏"} // ‚ö™
    
    // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
    alice.Friend = bob      // –ê–ª–∏—Å–∞ –¥—Ä—É–∂–∏—Ç —Å –ë–æ–±–æ–º
    
    // charlie –Ω–µ —Å–≤—è–∑–∞–Ω –Ω–∏ —Å –∫–µ–º
    
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è - –∫–æ—Ä–µ–Ω—å –¥–ª—è —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞
    globalPerson := alice
    
    // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞...
}
```

### üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞

1. **–®–∞–≥ 1**: –ù–∞—Ö–æ–¥–∏–º –∫–æ—Ä–Ω–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ —Å—Ç–µ–∫–µ)

   ```
   globalPerson (alice) ‚Üí üîò —Å–µ—Ä—ã–π (–ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ–∑–∂–µ)
   ```

2. **–®–∞–≥ 2**: –ë–µ—Ä–µ–º —Å–µ—Ä—ã–π –æ–±—ä–µ–∫—Ç `alice`, –∏—Å—Å–ª–µ–¥—É–µ–º –µ–≥–æ —Å–≤—è–∑–∏ –∏ –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º –≤ —á–µ—Ä–Ω—ã–π

   ```
   alice ‚Üí ‚ö´ —á–µ—Ä–Ω—ã–π (–ø—Ä–æ–≤–µ—Ä–∏–ª–∏)
   alice.Friend (bob) ‚Üí üîò —Å–µ—Ä—ã–π (–ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ–∑–∂–µ)
   ```

3. **–®–∞–≥ 3**: –ë–µ—Ä–µ–º —Å–µ—Ä—ã–π –æ–±—ä–µ–∫—Ç `bob`, –∏—Å—Å–ª–µ–¥—É–µ–º –µ–≥–æ —Å–≤—è–∑–∏ –∏ –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º –≤ —á–µ—Ä–Ω—ã–π

   ```
   bob ‚Üí ‚ö´ —á–µ—Ä–Ω—ã–π (–ø—Ä–æ–≤–µ—Ä–∏–ª–∏)
   bob.Friend == nil (–Ω–µ—Ç —Å–≤—è–∑–µ–π)
   ```

4. **–®–∞–≥ 4**: –í—Å–µ —Å–µ—Ä—ã–µ –æ–±—ä–µ–∫—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –í—Å–µ —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –±–µ–ª—ã–º - —ç—Ç–æ –º—É—Å–æ—Ä

   ```
   charlie ‚Üí ‚ö™ –±–µ–ª—ã–π (–º—É—Å–æ—Ä, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)
   ```

## üí° –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ: –ë–∞—Ä—å–µ—Ä—ã –∑–∞–ø–∏—Å–∏

–í –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å–≤—è–∑—å –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞:

```go
// –ß—Ç–æ –µ—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —ç—Ç–æ—Ç –∫–æ–¥?
func updateFriend() {
    bob.Friend = charlie  // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å —Å white –æ–±—ä–µ–∫—Ç–æ–º
}
```

–≠—Ç–æ –æ–ø–∞—Å–Ω–æ! –ï—Å–ª–∏ `bob` —É–∂–µ —á–µ—Ä–Ω—ã–π, –∞ `charlie` –±–µ–ª—ã–π, —Ç–æ `charlie` –±—É–¥–µ—Ç –æ—à–∏–±–æ—á–Ω–æ —É–¥–∞–ª–µ–Ω.

### üõ°Ô∏è –ë–∞—Ä—å–µ—Ä –∑–∞–ø–∏—Å–∏ (Write Barrier)

–ë–∞—Ä—å–µ—Ä –∑–∞–ø–∏—Å–∏ ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Å—ã–ª–æ–∫ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏:

```go
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ –±–∞—Ä—å–µ—Ä–∞ –∑–∞–ø–∏—Å–∏ –≤ Go 1.8+
func writePointer(slot, ptr) {
    // üõ°Ô∏è –ë–∞—Ä—å–µ—Ä –∑–∞–ø–∏—Å–∏
    shade(*slot)  // –ü–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—ä–µ–∫—Ç –≤ —Å–µ—Ä—ã–π
    if currentStack.isGrey {
        shade(ptr)  // –ï—Å–ª–∏ —Å—Ç–µ–∫ —Å–µ—Ä—ã–π, –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ–º –∏ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
    }
    *slot = ptr  // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–∞–º—É –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞–ø–∏—Å–∏
}

// –§—É–Ω–∫—Ü–∏—è shade –ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ—Ç –±–µ–ª—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Å–µ—Ä—ã–µ
func shade(obj) {
    if obj != nil && obj.color == white {
        obj.color = grey  // ‚ö™ ‚Üí üîò
    }
}
```

### üîÑ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –±–∞—Ä—å–µ—Ä–æ–º –∑–∞–ø–∏—Å–∏

–í–µ—Ä–Ω–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É –ø—Ä–∏–º–µ—Ä—É, –Ω–æ —Ç–µ–ø–µ—Ä—å —Å –±–∞—Ä—å–µ—Ä–æ–º –∑–∞–ø–∏—Å–∏:

```go
func main() {
    alice := &Person{Name: "–ê–ª–∏—Å–∞"} // ‚ö™
    bob := &Person{Name: "–ë–æ–±"}     // ‚ö™
    charlie := &Person{Name: "–ß–∞—Ä–ª–∏"} // ‚ö™
    
    globalPerson = alice  // –ö–æ—Ä–Ω–µ–≤–æ–π –æ–±—ä–µ–∫—Ç
    
    // –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞...
    // alice ‚Üí üîò, –ø–æ—Ç–æ–º ‚Üí ‚ö´
    // bob ‚Üí üîò, –ø–æ—Ç–æ–º ‚Üí ‚ö´
    
    // –í —ç—Ç–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
    bob.Friend = charlie  // üõ°Ô∏è –ë–∞—Ä—å–µ—Ä –∑–∞–ø–∏—Å–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç!
    // charlie ‚Üí üîò (–ø–µ—Ä–µ–∫—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –≤ —Å–µ—Ä—ã–π)
    
    // –°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...
    // charlie ‚Üí üîò, –ø–æ—Ç–æ–º ‚Üí ‚ö´
    
    // –í –∏—Ç–æ–≥–µ –Ω–∏ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –Ω–µ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
}
```

## üöÄ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Go –∏ —Å–±–æ—Ä–∫–æ–π –º—É—Å–æ—Ä–∞

1. **–ò–∑–±–µ–≥–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤** ‚ö†Ô∏è

   ```go
   // –ü–ª–æ—Ö–æ: –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
   for i := 0; i < 1000000; i++ {
       data := make([]byte, 1024)  // –°–æ–∑–¥–∞–µ–º –∏ —Å—Ä–∞–∑—É –∑–∞–±—ã–≤–∞–µ–º
       // ...
   }
   
   // –•–æ—Ä–æ—à–æ: –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç
   data := make([]byte, 1024)
   for i := 0; i < 1000000; i++ {
       // –ò—Å–ø–æ–ª—å–∑—É–µ–º data –ø–æ–≤—Ç–æ—Ä–Ω–æ
   }
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–ª—ã –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —á–∞—Å—Ç–æ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤** üèä

   ```go
   import "sync"
   
   var bufferPool = sync.Pool{
       New: func() interface{} {
           // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –±—É—Ñ–µ—Ä –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
           return make([]byte, 1024)
       },
   }
   
   func processData() {
       // –ë–µ—Ä–µ–º –±—É—Ñ–µ—Ä –∏–∑ –ø—É–ª–∞
       buffer := bufferPool.Get().([]byte)
       defer bufferPool.Put(buffer)  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—É–ª
       
       // –ò—Å–ø–æ–ª—å–∑—É–µ–º buffer...
   }
   ```

3. **–ò–∑–±–µ–≥–∞–π—Ç–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ** üîÑ

   ```go
   // –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞
   type Node struct {
       Parent *Node
       Children []*Node
   }
   
   // –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏ (–≤ Go –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
   // –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç —Ü–∏–∫–ª—ã
   ```

4. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã** üö™

   ```go
   file, err := os.Open("data.txt")
   if err != nil {
       return err
   }
   defer file.Close()  // –í—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª
   ```

## ü§î –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞?

1. **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏** üìà
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–±–æ—Ä–∫–∏
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π GOGC (–Ω–∞–ø—Ä–∏–º–µ—Ä, GOGC=50 –∑–∞–ø—É—Å—Ç–∏—Ç —Å–±–æ—Ä–∫—É –±—ã—Å—Ç—Ä–µ–µ)

2. **–ü–æ —Ç–∞–π–º–µ—Ä—É, –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã** ‚è±Ô∏è
   - –î–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏

3. **–í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ runtime.GC()** üîÑ
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ!

## üìö –ö–∞–∫ —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ —Ä–∞–±–æ—Ç–µ —Å –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏?

–ö–∞–Ω–∞–ª—ã –∏ –≥–æ—Ä—É—Ç–∏–Ω—ã –Ω–∞–ø—Ä—è–º—É—é —Å GC –Ω–µ —Å–≤—è–∑–∞–Ω—ã, –Ω–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:

```go
func worker(jobs <-chan int, results chan<- int) {
    for job := range jobs {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–¥–∞—á—É
        results <- job * 2
    }
}

func main() {
    jobs := make(chan int, 100)      // –ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è –∑–∞–¥–∞–Ω–∏–π
    results := make(chan int, 100)   // –ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤
    for w := 0; w < 3; w++ {
        go worker(jobs, results)  // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞–Ω–∏—è
    for i := 0; i < 9; i++ {
        jobs <- i  // –ü–æ–º–µ—â–∞–µ–º –∑–∞–¥–∞–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª
    }
    close(jobs)  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª - —Å–∏–≥–Ω–∞–ª –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for i := 0; i < 9; i++ {
        result := <-results
        fmt.Println(result)
    }
}
```

### üîë –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏

1. **–í—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –∫–∞–Ω–∞–ª—ã** üö™
   - –ö–∞–Ω–∞–ª—ã —ç—Ç–æ —Ä–µ—Å—É—Ä—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞
   - –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–π –∫–∞–Ω–∞–ª —Å –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ –ø–∞–º—è—Ç–∏

2. **–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –≥–æ—Ä—É—Ç–∏–Ω—ã** ‚ö†Ô∏è
   - –ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–∞–º—è—Ç—å (–º–∏–Ω–∏–º—É–º 2KB)
   - –ï—Å–ª–∏ —Å–æ–∑–¥–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω, —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –±—É–¥–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π** üõë

   ```go
   import "context"
   
   func worker(ctx context.Context, jobs <-chan int) {
       for {
           select {
           case <-ctx.Done():
               // –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–º–µ–Ω–µ–Ω, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É
               return
           case job, ok := <-jobs:
               if !ok {
                   // –ö–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É
                   return
               }
               // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º job...
           }
       }
   }
   
   func main() {
       ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
       defer cancel()  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º cancel
       
       jobs := make(chan int, 10)
       go worker(ctx, jobs)
       
       // –†–∞–±–æ—Ç–∞–µ–º 5 —Å–µ–∫—É–Ω–¥, –∑–∞—Ç–µ–º –≤–æ—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
   }
   ```

## üéØ –ò—Ç–æ–≥–∏: –∫–æ–≥–¥–∞ –¥—É–º–∞—Ç—å –æ —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞?

1. **–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö** üìä
   - –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–æ–≤–æ, –∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å—ë –≤ –ø–∞–º—è—Ç—å

2. **–í –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö** üöÄ
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–∞—É–∑–∞–º–∏ GC —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–í —Å–∏—Å—Ç–µ–º–∞—Ö —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏** ‚è±Ô∏è
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ä–µ–∫—Ç–Ω—ã–µ –ø—É–ª—ã –∏ –ø—Ä–µ–¥–∞–ª–ª–æ–∫–∞—Ü–∏—é

4. **–í –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é** üì¶
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GOGC –¥–ª—è –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞


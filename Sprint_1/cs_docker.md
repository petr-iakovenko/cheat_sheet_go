# 🐳 Docker Шпаргалка

## 📌 Основные концепции Docker

Docker - это платформа для разработки, доставки и запуска приложений в контейнерах.

- **Образ (Image)** 📦 - шаблон для создания контейнера
- **Контейнер (Container)** 📦➡️🏃 - запущенный экземпляр образа
- **Реестр (Registry)** 🏪 - хранилище образов (DockerHub, GitHub Container Registry)
- **Dockerfile** 📝 - инструкция для сборки образа

## 🔍 Системные команды

- `docker info` 📊 - показать информацию о системе Docker
- `docker version` ℹ️ - показать версию Docker
- `docker system df` 💾 - выводит статистику по образам и контейнерам (занимаемая память)
- `docker system prune` 🧹 - удалить все неиспользуемые контейнеры, сети и образы
- `docker system prune -a` 🧹🔄 - удалить все неиспользуемые ресурсы, включая остановленные контейнеры

## 📦 Работа с образами

- `docker images` или `docker image ls` 📋 - просмотреть список образов
- `docker pull <образ>` ⬇️ - скачать из репозитория образ (DockerHub)
- `docker rmi <образ> [образ...]` или `docker image rm <образ> [образ...]` 🗑️ - удалить образ(ы)
- `docker image prune` 🧹 - удалить все неиспользуемые образы
- `docker image history <образ>` 📜 - показать историю слоев образа
- `docker image inspect <образ>` 🔍 - детальная информация об образе
- `docker search <ключевое_слово>` 🔎 - поиск образов в DockerHub

## 🏃 Работа с контейнерами

### Создание и запуск контейнеров

- `docker run <образ>` ▶️ - создать и запустить контейнер на основе указанного образа
- `docker run --name <имя> <образ>` 🏷️▶️ - создать и запустить контейнер с указанным именем
- `docker run --name <имя> -d <образ>` 🏷️🔄 - создать и запустить контейнер в фоновом режиме
- `docker run --rm <образ>` ▶️🧹 - удалять контейнер после завершения его работы
- `docker run -it <образ>` или `docker run -i -t <образ>` 💻▶️ - запустить с интерактивным режимом
- `docker run -p <порт_хоста>:<порт_контейнера> <образ>` 🔌 - проброс портов
- `docker run -e <ПЕРЕМЕННАЯ>=<значение> <образ>` 🔧 - установка переменных окружения

### Управление контейнерами

- `docker ps` 📋 - вывести список только запущенных контейнеров
- `docker ps -a` или `docker ps --all` 📋➕ - вывести список всех контейнеров
- `docker ps -q` или `docker ps --quiet` 🆔 - вывести только ID контейнеров
- `docker stop <имя_контейнера>` или `docker stop <id_контейнера>` ⏹️ - остановить контейнер
- `docker start <имя_контейнера>` или `docker start <id_контейнера>` ▶️ - запустить остановленный контейнер
- `docker restart <имя_контейнера>` 🔄 - перезапустить контейнер
- `docker rm <имя_контейнера>` или `docker rm <id_контейнера>` 🗑️ - удалить контейнер
- `docker rm -f <имя_контейнера>` 🗑️❗ - принудительно удалить запущенный контейнер
- `docker stop $(docker ps -q)` ⏹️📋 - остановить все запущенные контейнеры
- `docker rm $(docker ps -aq)` 🗑️📋 - удалить все контейнеры

### Взаимодействие с контейнерами

- `docker exec <имя_контейнера> <команда>` ▶️🔧 - выполнить команду в работающем контейнере
- `docker exec -it <имя_контейнера> bash` 💻🔧 - интерактивный вход в контейнер через bash
- `docker logs <имя_контейнера>` 📜 - просмотр логов контейнера
- `docker logs -f <имя_контейнера>` 📜🔄 - просмотр логов в режиме реального времени
- `docker stats` 📊 - мониторинг ресурсов контейнеров в реальном времени
- `docker cp <путь_к_файлу> <имя_контейнера>:<путь_в_контейнере>` 📂➡️📦 - копирование в контейнер
- `docker cp <имя_контейнера>:<путь_в_контейнере> <путь_к_файлу>` 📦➡️📂 - копирование из контейнера
- `docker inspect <имя_контейнера>` 🔍 - детальная информация о контейнере
- `docker top <имя_контейнера>` 📊 - показать запущенные процессы в контейнере

## 💾 Работа с данными

### Volumes (тома)

- `docker volume ls` 📋 - показать все созданные тома
- `docker volume create <имя>` ➕ - создать новый том
- `docker volume rm <имя>` 🗑️ - удалить том
- `docker volume prune` 🧹 - удалить все неиспользуемые тома
- `docker volume inspect <имя>` 🔍 - информация о томе

### Примеры подключения томов

- `docker run -v <имя_тома>:<путь_в_контейнере> <образ>` 💾▶️ - запуск контейнера с томом
- `docker run -v <путь_на_хосте>:<путь_в_контейнере> <образ>` 📂▶️ - bind mount (монтирование директории)
- `docker run -v <путь_на_хосте>:<путь_в_контейнере>:ro <образ>` 📂👁️ - монтирование только для чтения

**Отличия Volume и Bind Mount**:

- 💾 **Volumes**: независимы от хост-системы, более безопасны, находятся в специальной директории Docker
- 📂 **Bind Mount**: прямое монтирование директории хоста, используется для секретных файлов и разработки

## 📝 Dockerfile

### Основные инструкции

- `FROM <образ>:<тег>` 🧩 - базовый образ для сборки
- `WORKDIR <путь>` 📂 - рабочая директория в контейнере
- `COPY <источник> <назначение>` 📋➡️ - копирование файлов из контекста сборки
- `ADD <источник> <назначение>` 📦➡️ - копирование файлов, архивов или URL
- `RUN <команда>` ⚙️ - выполнение команды при сборке образа
- `ENV <ключ>=<значение>` 🔧 - установка переменной окружения
- `EXPOSE <порт>` 🔌 - документирование порта контейнера
- `VOLUME <путь>` 💾 - создание точки монтирования для тома
- `CMD ["команда", "параметр1"]` ▶️ - команда по умолчанию при запуске контейнера
- `ENTRYPOINT ["команда", "параметр1"]` 🚀 - основная команда при запуске контейнера
- `HEALTHCHECK` ❤️ - проверка работоспособности контейнера

### Сборка образа

- `docker build -t <имя_образа>:<тег> <путь>` 🔨 - сборка образа
- `docker build -t <имя_образа>:<тег> -f <путь_к_Dockerfile> <путь>` 🔨📝 - указание нестандартного Dockerfile
- `docker build --no-cache -t <имя_образа>:<тег> <путь>` 🔨🔄 - сборка без использования кэша

## 🌐 Сеть

- `docker network ls` 📋 - список сетей Docker
- `docker network create <имя>` ➕ - создание сети
- `docker network rm <имя>` 🗑️ - удаление сети
- `docker network inspect <имя>` 🔍 - детальная информация о сети
- `docker run --network <имя_сети> <образ>` 🌐▶️ - запуск контейнера в указанной сети

## 🤝 Docker Compose

- `docker-compose up` ▶️ - создание и запуск сервисов
- `docker-compose up -d` 🔄 - запуск в фоновом режиме
- `docker-compose down` ⏹️ - остановка и удаление контейнеров и сетей
- `docker-compose down -v` ⏹️🧹 - остановка и удаление контейнеров, сетей и томов
- `docker-compose ps` 📋 - список запущенных сервисов
- `docker-compose logs` 📜 - логи сервисов
- `docker-compose build` 🔨 - сборка или пересборка сервисов

## 🛠️ Полезные команды bash

- `touch <имя_файла>` ➕ - создать файл
- `mv <текущее_имя> <новое_имя>` 🔄 - переименовать файл
- `pwd` 📍 - показать текущий путь
- `$(pwd)` 📍 - подстановка текущего пути в команду
- `ls -la` 📋 - показать все файлы и директории с подробностями
- `grep <текст> <файл>` 🔍 - поиск в файле
- `cat <файл>` 📄 - вывести содержимое файла
- `mkdir <имя>` 📁 - создать директорию

### Работа с редактором vi/vim

- `i` ✏️ - режим ввода текста
- `Esc` 🔙 - выход из режима ввода
- `:wq!` 💾 - сохранение и выход
- `:q!` 🚪 - выход без сохранения
- `dd` ✂️ - удаление строки
- `x` 🗑️ - удаление символа под курсором

## 💡 Лайфхаки Docker

- `docker stop $(docker ps -q)` ⏹️📋 - остановить все запущенные контейнеры
- `docker rm $(docker ps -aq)` 🗑️📋 - удалить все контейнеры
- `docker rmi $(docker images -q)` 🗑️📦 - удалить все образы
- `docker exec -it $(docker ps -q) bash` 💻 - войти в последний запущенный контейнер
- `docker stats $(docker ps --format={{.Names}})` 📊 - мониторинг всех запущенных контейнеров
- `.dockerignore` 🙈 - файл для исключения файлов из контекста сборки

## 🔒 Безопасность Docker

- `docker scan <образ>` 🔍🛡️ - сканирование образа на уязвимости
- `docker run --read-only <образ>` 👁️ - запуск контейнера в режиме только для чтения
- `docker run --cap-drop=ALL <образ>` 🔒 - запуск с минимальными правами
- `docker run --user <пользователь> <образ>` 👤 - запуск от имени указанного пользователя

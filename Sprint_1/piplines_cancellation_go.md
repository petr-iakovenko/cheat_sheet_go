# Go Concurrency Patterns: Pipelines and cancellation

–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ - [—Å—Å—ã–ª–∫–∞](https://go.dev/blog/pipelines)

–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω **fan-out/fan-in** - [—Å—Å—ã–ª–∫–∞](https://dzen.ru/a/ZUkC52CW8UQlC7vp)

---

Go –∫–∞–Ω–∞–ª—ã –∏ –≥–æ—Ä—É—Ç–∏–Ω—ã —Å–æ–∑–¥–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω–≤–µ–π–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö (pipelines) —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª–∞–º–∏. –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∫–ª—é—á–∞—é—Ç: fan-out (—Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã), fan-in (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤) –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã.

## üöÄ –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω–≤–µ–π–µ—Ä—ã (pipelines) –≤ Go?

–ö–æ–Ω–≤–µ–π–µ—Ä –≤ Go - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä —ç—Ç–∞–ø–æ–≤ (stages), —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–∞–º–∏. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø - —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –≥–æ—Ä—É—Ç–∏–Ω, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é:

1. –ü–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ
3. –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤—ã—Ö–æ–¥–Ω–æ–π –∫–∞–Ω–∞–ª

–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –Ω–∞ –ø—Ä–æ—Å—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ:

```go
// –ü—Ä–æ—Å—Ç–æ–π –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–∏—Å–µ–ª
package main

import (
    "fmt"
    "time"
)

// üì• –≠—Ç–∞–ø 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–µ–ª
func generateNumbers() <-chan int {
    out := make(chan int)
    go func() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º defer –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        defer close(out)
        for i := 1; i <= 5; i++ {
            fmt.Printf("‚è© –û—Ç–ø—Ä–∞–≤–ª—è—é —á–∏—Å–ª–æ: %d\n", i)
            out <- i
            time.Sleep(100 * time.Millisecond) // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
        }
    }()
    return out
}

// üîÑ –≠—Ç–∞–ø 2: –£–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 2
func multiplyByTwo(in <-chan int) <-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for number := range in {
            result := number * 2
            fmt.Printf("‚úñÔ∏è –£–º–Ω–æ–∂–∞—é %d –Ω–∞ 2: %d\n", number, result)
            out <- result
            time.Sleep(200 * time.Millisecond) // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
        }
    }()
    return out
}

// üìä –≠—Ç–∞–ø 3: –ü—Ä–∏–±–∞–≤–ª–µ–Ω–∏–µ 10
func addTen(in <-chan int) <-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for number := range in {
            result := number + 10
            fmt.Printf("‚ûï –ü—Ä–∏–±–∞–≤–ª—è—é –∫ %d —á–∏—Å–ª–æ 10: %d\n", number, result)
            out <- result
            time.Sleep(150 * time.Millisecond) // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
        }
    }()
    return out
}

func main() {
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä
    numbers := generateNumbers()
    doubled := multiplyByTwo(numbers)
    results := addTen(doubled)

    // –ü–æ—Ç—Ä–µ–±–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for r := range results {
        fmt.Printf("üìù –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: %d\n", r)
    }

    fmt.Println("üèÅ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
}
```

## üîÑ –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–µ–ª**: –ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø —Å–æ–∑–¥–∞—ë—Ç —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 5 –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ –∫–∞–Ω–∞–ª.
2. **–£–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 2**: –í—Ç–æ—Ä–æ–π —ç—Ç–∞–ø –ø–æ–ª—É—á–∞–µ—Ç —á–∏—Å–ª–∞, —É–º–Ω–æ–∂–∞–µ—Ç –∏—Ö –Ω–∞ 2 –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–ª—å—à–µ.
3. **–ü—Ä–∏–±–∞–≤–ª–µ–Ω–∏–µ 10**: –¢—Ä–µ—Ç–∏–π —ç—Ç–∞–ø –ø–æ–ª—É—á–∞–µ—Ç —É–¥–≤–æ–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞ –∏ –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç –∫ –Ω–∏–º 10.
4. **–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**: –í `main()` –º—ã —á–∏—Ç–∞–µ–º –∏ –≤—ã–≤–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

## üåü –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∫–æ–Ω–≤–µ–π–µ—Ä–æ–≤

1. **–ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–æ–≤**: –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–≤–æ–π –≤—ã—Ö–æ–¥–Ω–æ–π –∫–∞–Ω–∞–ª, –∫–æ–≥–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É (`defer close(out)`).
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è**: –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–æ–∫–∞ –≤—Ö–æ–¥–Ω–æ–π –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É—è `for number := range in`).
3. **–ì–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏**: –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Å–≤–æ–µ–π –≥–æ—Ä—É—Ç–∏–Ω–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å–µ–º —ç—Ç–∞–ø–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## üîÄ Fan-out –∏ Fan-in

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –¥–≤–µ –≤–∞–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏: fan-out –∏ fan-in.

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–µ–ª - –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø—Ä–∏–º–µ—Ä–µ
func generateNumbers() <-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for i := 1; i <= 10; i++ {
            fmt.Printf("‚è© –û—Ç–ø—Ä–∞–≤–ª—è—é —á–∏—Å–ª–æ: %d\n", i)
            out <- i
            time.Sleep(100 * time.Millisecond)
        }
    }()
    return out
}

// –í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç
func squareNumber(in <-chan int) <-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for number := range in {
            time.Sleep(500 * time.Millisecond) // –ò–º–∏—Ç–∞—Ü–∏—è —Ç—è–∂–µ–ª–æ–π —Ä–∞–±–æ—Ç—ã
            result := number * number
            fmt.Printf("üî¢ %d –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ: %d\n", number, result)
            out <- result
        }
    }()
    return out
}

// üåü Fan-in (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤)
func mergeChannels(channels ...<-chan int) <-chan int {
    var wg sync.WaitGroup
    merged := make(chan int)
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π
    copyValues := func(ch <-chan int) {
        defer wg.Done()
        for val := range ch {
            merged <- val
        }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É-–∫–æ–ø–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
    wg.Add(len(channels))
    for _, ch := range channels {
        go copyValues(ch)
    }
    
    // –ì–æ—Ä—É—Ç–∏–Ω–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ–ø–∏—Ä–æ–≤—â–∏–∫–æ–≤
    go func() {
        wg.Wait()
        close(merged)
    }()
    
    return merged
}

func main() {
    numbers := generateNumbers()
    
    // üåü Fan-out: –∑–∞–ø—É—Å–∫–∞–µ–º 3 "–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞" —Å –æ–¥–Ω–∏–º –≤—Ö–æ–¥–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º
    worker1 := squareNumber(numbers)
    worker2 := squareNumber(numbers)
    worker3 := squareNumber(numbers)
    
    // üåü Fan-in: –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª
    results := mergeChannels(worker1, worker2, worker3)
    
    // –ü–æ—Ç—Ä–µ–±–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for result := range results {
        fmt.Printf("üìù –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: %d\n", result)
    }
    
    fmt.Println("üèÅ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
}
```

---

## üîç –ß—Ç–æ —Ç–∞–∫–æ–µ Fan-out –∏ Fan-in?

1. **Fan-out (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)** - —ç—Ç–æ –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω —á–∏—Ç–∞—é—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –í –ø—Ä–∏–º–µ—Ä–µ: `worker1`, `worker2`, `worker3` - –≤—Å–µ —á–∏—Ç–∞—é—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ `numbers`.

2. **Fan-in (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ)** - —ç—Ç–æ –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤. –§—É–Ω–∫—Ü–∏—è `mergeChannels` –±–µ—Ä–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Ö–æ–¥–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö –≤ –æ–¥–∏–Ω –≤—ã—Ö–æ–¥–Ω–æ–π.

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã

–ò–Ω–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä –¥–æ—Å—Ä–æ—á–Ω–æ. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª Ctrl+C –∏–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞:

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–µ–ª —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–º–µ–Ω—ã
func generateNumbers(cancel <-chan struct{}) <-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for i := 1; ; i++ {
            select {
            case <-cancel:
                fmt.Println("‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–∏—Å–µ–ª –æ—Ç–º–µ–Ω–µ–Ω–∞")
                return
            case out <- i:
                fmt.Printf("‚è© –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–∏—Å–ª–æ: %d\n", i)
                time.Sleep(200 * time.Millisecond)
            }
        }
    }()
    return out
}

// –í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–º–µ–Ω—ã
func squareNumber(cancel <-chan struct{}, in <-chan int) <-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for number := range in {
            select {
            case <-cancel:
                fmt.Println("‚ùå –í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω–æ")
                return
            case out <- number * number:
                fmt.Printf("üî¢ %d –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ: %d\n", number, number*number)
                time.Sleep(300 * time.Millisecond)
            }
        }
    }()
    return out
}

func main() {
    // –ö–∞–Ω–∞–ª –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç–º–µ–Ω—ã
    cancel := make(chan struct{})
    
    numbers := generateNumbers(cancel)
    squares := squareNumber(cancel, numbers)
    
    // –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5 –∑–Ω–∞—á–µ–Ω–∏–π
    for i := 0; i < 5; i++ {
        fmt.Printf("üìù –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: %d\n", <-squares)
    }
    
    // –û—Ç–º–µ–Ω—è–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä
    fmt.Println("üõë –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—ã")
    close(cancel)
    
    // –î–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω–∞–º –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
    time.Sleep(1 * time.Second)
    fmt.Println("üèÅ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
}
```

## üîë –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –æ—Ç–º–µ–Ω—ã

1. **–ö–∞–Ω–∞–ª –æ—Ç–º–µ–Ω—ã**: –ú—ã —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª `cancel`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ select**: –í –∫–∞–∂–¥–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `select` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞, —Ç–∞–∫ –∏ –∫–∞–Ω–∞–ª–∞ –æ—Ç–º–µ–Ω—ã.

3. **–ó–∞–∫—Ä—ã—Ç–∏–µ –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞**: –ú—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –æ—Ç–º–µ–Ω—ã (`close(cancel)`), –∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ. –ö–æ–≥–¥–∞ –∫–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è (`<-cancel`) —Å—Ä–∞–∑—É –∂–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ–º –≥–æ—Ä—É—Ç–∏–Ω–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã?

1. **–ö–æ–Ω–≤–µ–π–µ—Ä—ã** –∏–¥–µ–∞–ª—å–Ω—ã, –∫–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ —ç—Ç–∞–ø—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

2. **Fan-out** –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ API.

3. **Fan-in** –Ω–µ–æ–±—Ö–æ–¥–∏–º, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫.

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã** –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–∫–∏ –≥–æ—Ä—É—Ç–∏–Ω –∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è.

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

1. **–í—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –∫–∞–Ω–∞–ª—ã**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `defer close(out)` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–Ω–∞–ª –∑–∞–∫—Ä–æ–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫.

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sync.WaitGroup** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω.

3. **–ü—Ä–æ–¥—É–º—ã–≤–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**: –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤–æ–∑–º–æ–∂–Ω—É—é –æ—à–∏–±–∫—É.

4. **–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ—Ç–º–µ–Ω—ã**: –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `context.Context` –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–¥–µ–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –æ—Ç–º–µ–Ω—ã.

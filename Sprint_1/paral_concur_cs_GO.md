# Конкурентность и паралелизм в программировании

[Видео - **О конуркнтности и паралелизме**](paral_concur_cs_GO.md)

---

## Конкурентность и параллелизм в программировании

### Конкурентность (Concurrency)

Конкурентность — это способность программы выполнять **несколько задач одновременно**, **но не обязательно в один и тот же момент времени**. Главная идея в том, что задачи "сосуществуют" и могут переключаться между собой для максимального использования ресурсов.

Конкурентность полезна, когда нужно управлять несколькими потоками выполнения, например, обработкой множества запросов на сервере, где задачи могут приостанавливаться и возобновляться.

---

### Параллелизм (Parallelism)

Параллелизм — это выполнение **нескольких задач одновременно**, **именно в один и тот же момент времени**. Это возможно только на многопроцессорных или многоядерных системах, где несколько ядер работают независимо, исполняя разные задачи.

---

### Различия между конкурентностью и параллелизмом

| **Конкурентность**                          | **Параллелизм**                          |
|---------------------------------------------|------------------------------------------|
| Управляет многими задачами одновременно.    | Выполняет несколько задач одновременно.  |
| Зависит от логики переключения задач.       | Требует многопроцессорной архитектуры.   |
| Может работать на одном ядре процессора.    | Требует нескольких ядер или процессоров. |
| Пример: обработка запросов на сервере.      | Пример: рендеринг 3D-сцены.              |

### Примеры работы с разными видами процессоров

#### 1. **Одноядерный процессор**

На одноядерном процессоре **конкурентность** возможна, но **параллелизм невозможен**, так как только одна задача может выполняться в данный момент времени. Пример:

- Сервер обрабатывает запросы, переключаясь между задачами, чтобы избежать блокировок.

#### 2. **Многоядерный процессор**

На многоядерных процессорах возможно как конкурентное выполнение (с разделением задач на ядра), так и параллельное выполнение. Пример:

- 4 ядра:
  - 2 ядра обрабатывают входящие сетевые запросы (конкурентно).
  - 2 ядра выполняют сложные вычисления (параллельно).

#### 3. **Многопроцессорная система**

Многопроцессорная система позволяет параллельное выполнение на уровне процессов. Пример:

- Каждый процесс запускает отдельный набор горутин для выполнения своих задач, эффективно используя ресурсы всех процессоров.

---

### Пример сервера

Представим сервер, который принимает запросы и обрабатывает их одновременно, используя конкурентность:

**Логика**:

1. Сервер запускает горутину для обработки каждого запроса.
2. Если процессор многопоточный, эти запросы могут выполняться параллельно.

**Реальный пример**:

- Сервер Go обрабатывает запросы пользователей API.
- Каждый запрос обрабатывается в отдельной горутине.
- Параллелизм достигается, если процессор поддерживает многопоточность, например, 8 ядер могут обрабатывать 8 запросов одновременно.

---

### Пример конкурентности и параллелизма в Go

Код-пример:  

```go
package main

import (
  "fmt"
  "sync"
  "time"
)

// worker — функция, имитирующая выполнение задачи, которая занимает 2 секунды.
func worker(id int) {
  fmt.Printf("Worker %d: Начал работу\n", id)
  time.Sleep(2 * time.Second) // Имитация длительной работы
  fmt.Printf("Worker %d: Закончил работу\n", id)
}

func main() {
  var wg sync.WaitGroup // WaitGroup используется для ожидания завершения всех горутин.
  wg.Add(3)             // Устанавливаем счетчик на 3, так как запускаем 3 горутины.

  for i := 1; i <= 3; i++ {
    // Запускаем горутину для каждого worker
    go func(id int) {
      defer wg.Done() // Уменьшаем счётчик WaitGroup после завершения горутины.
      worker(id)      // Вызываем функцию worker для выполнения задачи.
    }(i)              // Передаём переменную i в качестве аргумента.
 }

  wg.Wait() // Ожидаем завершения всех горутин.
  fmt.Println("Все работы завершены")
}
```

### Объяснение конкурентности и параллелизма из примера

#### 1. Конкурентность

- Конкурентность в этом примере реализована через **горутины**. Горутины запускают выполнение функции `worker` независимо от главного потока выполнения.
- Хотя все 3 горутины работают одновременно, они **не обязательно выполняются параллельно**, если процессор только одноядерный. Вместо этого задачи будут чередоваться (переключение между горутинами).

```go
go func(id int) {
  defer wg.Done() // Горутина сигнализирует, что завершила свою работу.
  worker(id)      // Выполнение работы (конкурентность: все горутины работают одновременно).
}(i)
```

- Здесь каждая горутина конкурирует за процессорное время, что демонстрирует **конкурентность**.

#### 2. Параллелизм

- Если процессор многоядерный, задачи `worker` могут быть выполнены **параллельно**, где каждая горутина исполняется на отдельном ядре.
- Например, на 2-ядерном процессоре:
  - Первая и вторая горутины могут работать параллельно, а третья начнёт, как только освободится одно из ядер.
- На 4-ядерном процессоре все 3 горутины могут выполняться одновременно (идеальный параллелизм).

```go
time.Sleep(2 * time.Second) // Имитация выполнения задачи (возможен параллелизм, если есть свободные ядра).
```

- Если ядра свободны, задачи исполняются **реально одновременно**.

#### 3. Главная горутина

- Главная горутина в функции `main` использует `WaitGroup`, чтобы ожидать завершения всех горутин. Это позволяет программе завершить выполнение только после того, как все горутины закончат свои задачи.

```go
wg.Wait() // Главная горутина блокируется, пока все горутины не завершатся (синхронизация конкурентных задач).
```

- Здесь `wg.Wait()` синхронизирует выполнение, чтобы завершение программы было корректным.

---

#### Итог логики кода

- **Конкурентность**: Каждая горутина запускает задачу одновременно, не ожидая завершения других.
- **Параллелизм**: Если процессор имеет несколько ядер, горутины могут выполняться одновременно на разных ядрах.
- Этот код подходит для задач, где несколько независимых операций могут быть выполнены одновременно, например, обработка запросов, вычисления или ввод/вывод.

---

### Общий итог

1. **Конкурентность**: управление задачами, выполняемыми одновременно.
2. **Параллелизм**: реальное выполнение задач одновременно на нескольких ядрах.
3. **Работа с разными процессорами**:
   - Одноядерные системы позволяют только конкурентность.
   - Многоядерные системы позволяют и конкурентность, и параллелизм.
